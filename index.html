<!DOCTYPE html>
<html lang="pt-PT">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Guia de Estudo: União Ibérica (1580–1640)</title>
    <style>
        :root {
            --primary: #8B3A3A; /* Tom terracota/histórico */
            --secondary: #1F2937; /* Cinzento escuro */
            --accent: #D97706; /* Dourado */
            --bg-color: #F3F4F6;
            --text-color: #1F2937;
            --white: #FFFFFF;
            --success: #10B981;
            --error: #EF4444;
            --paper: #fdfbf7;
        }

        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }

        body {
            background-color: var(--bg-color);
            color: var(--text-color);
            line-height: 1.6;
        }

        /* Header */
        header {
            background-color: var(--primary);
            color: var(--white);
            padding: 1.5rem;
            text-align: center;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }

        header h1 {
            font-size: 1.8rem;
            margin-bottom: 0.5rem;
        }

        header p {
            font-size: 1rem;
            opacity: 0.9;
        }

        /* Navigation */
        nav {
            background-color: var(--secondary);
            position: sticky;
            top: 0;
            z-index: 100;
        }

        .nav-container {
            display: flex;
            justify-content: center;
            max-width: 1000px;
            margin: 0 auto;
            flex-wrap: wrap;
        }

        .nav-btn {
            background: none;
            border: none;
            color: var(--white);
            padding: 1rem 2rem;
            font-size: 1rem;
            cursor: pointer;
            transition: background 0.3s;
            font-weight: 600;
        }

        .nav-btn:hover {
            background-color: rgba(255,255,255,0.1);
        }

        .nav-btn.active {
            background-color: var(--accent);
            color: var(--white);
        }

        /* Botão Certificado (Inicialmente Oculto) */
        #btn-certificado {
            display: none; 
            background-color: var(--success);
            color: white;
            animation: pulse 2s infinite;
        }
        
        #btn-certificado.visible {
            display: block;
        }

        @keyframes pulse {
            0% { transform: scale(1); }
            50% { transform: scale(1.05); }
            100% { transform: scale(1); }
        }

        /* Main Content */
        main {
            max-width: 1000px;
            margin: 2rem auto;
            padding: 0 1rem;
            min-height: 80vh;
        }

        .section-content {
            display: none;
            background: var(--white);
            padding: 2rem;
            border-radius: 8px;
            box-shadow: 0 4px 6px rgba(0,0,0,0.05);
            animation: fadeIn 0.5s ease;
        }

        .section-content.active {
            display: block;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }

        h2 {
            color: var(--primary);
            border-bottom: 2px solid var(--accent);
            padding-bottom: 0.5rem;
            margin-bottom: 1.5rem;
            margin-top: 2rem;
        }
        
        h2:first-of-type {
            margin-top: 0;
        }

        h3 {
            color: var(--secondary);
            margin-bottom: 1rem;
            margin-top: 1.5rem;
            font-size: 1.3rem;
        }

        ul {
            list-style-position: inside;
            margin-left: 1rem;
            margin-bottom: 1rem;
        }

        li {
            margin-bottom: 0.5rem;
        }

        strong {
            color: var(--primary);
        }

        /* Analogia Box */
        .analogy-box {
            background-color: #FFFBEB;
            border-left: 4px solid var(--accent);
            padding: 1.5rem;
            margin: 2rem 0;
            border-radius: 4px;
        }

        /* Quiz Styles */
        .question-block {
            margin-bottom: 2.5rem;
            padding-bottom: 1.5rem;
            border-bottom: 1px solid #eee;
        }

        .question-text {
            font-weight: bold;
            font-size: 1.1rem;
            margin-bottom: 1rem;
        }

        .options-container label {
            display: block;
            padding: 0.8rem;
            margin-bottom: 0.5rem;
            background: #f9fafb;
            border: 1px solid #e5e7eb;
            border-radius: 4px;
            cursor: pointer;
            transition: all 0.2s;
        }

        .options-container label:hover {
            background: #f3f4f6;
            border-color: #d1d5db;
        }

        .options-container input {
            margin-right: 10px;
        }

        .feedback {
            margin-top: 1rem;
            padding: 1rem;
            border-radius: 4px;
            display: none;
            font-size: 0.95rem;
        }

        .feedback.correct {
            background-color: #DCFCE7;
            color: #065F46;
            border: 1px solid #34D399;
            display: block;
        }

        .feedback.incorrect {
            background-color: #FEE2E2;
            color: #991B1B;
            border: 1px solid #F87171;
            display: block;
        }

        /* Drag and Drop Styles */
        .drag-container {
            display: flex;
            flex-wrap: wrap;
            gap: 20px;
            margin-top: 1rem;
        }

        .drag-column {
            flex: 1;
            min-width: 250px;
            background: #f8fafc;
            padding: 1rem;
            border-radius: 6px;
        }

        .draggable-item {
            background: white;
            padding: 0.8rem;
            margin-bottom: 0.5rem;
            border: 1px solid #e2e8f0;
            border-radius: 4px;
            cursor: pointer;
            box-shadow: 0 1px 2px rgba(0,0,0,0.05);
            transition: transform 0.2s, background-color 0.2s;
        }

        .draggable-item:hover {
            transform: translateX(5px);
        }

        .sortable-list {
            list-style: none;
            padding: 0;
            margin: 0;
        }

        .sortable-item {
            background: white;
            border: 1px solid #e2e8f0;
            padding: 1rem;
            margin-bottom: 0.5rem;
            cursor: grab;
            display: flex;
            align-items: center;
            border-radius: 4px;
        }

        .btn-check {
            background-color: var(--primary);
            color: white;
            border: none;
            padding: 1rem 2rem;
            border-radius: 4px;
            cursor: pointer;
            font-size: 1.1rem;
            margin-top: 1rem;
            width: 100%;
            font-weight: bold;
            box-shadow: 0 2px 4px rgba(0,0,0,0.2);
        }

        .btn-check:hover {
            background-color: #702f2f;
        }

        /* GLOSSARY STYLES */
        .glossary-grid {
            display: flex;
            flex-direction: column;
            gap: 1rem;
        }

        .glossary-item {
            background: #f9fafb;
            border-radius: 6px;
            border-left: 4px solid var(--primary);
            overflow: hidden;
            cursor: pointer;
            transition: box-shadow 0.3s;
        }

        .glossary-item:hover {
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
        }

        .glossary-header {
            padding: 1.5rem;
            display: flex;
            justify-content: space-between;
            align-items: center;
            font-weight: bold;
            color: var(--primary);
            font-size: 1.1rem;
        }

        .glossary-toggle {
            font-size: 1.5rem;
            line-height: 1;
            color: var(--accent);
            transition: transform 0.3s;
        }

        .glossary-content {
            max-height: 0;
            overflow: hidden;
            padding: 0 1.5rem;
            transition: all 0.3s ease-out;
            background-color: white;
            color: var(--secondary);
        }

        .glossary-item.expanded .glossary-toggle {
            transform: rotate(45deg);
        }

        .glossary-item.expanded .glossary-content {
            padding-bottom: 1.5rem;
            max-height: 200px;
            border-top: 1px solid #eee;
        }

        /* CERTIFICATE STYLES */
        .certificate-wrapper {
            border: 10px double var(--primary);
            padding: 2rem;
            background-color: var(--paper);
            text-align: center;
            margin-top: 2rem;
            position: relative;
            background-image: radial-gradient(#e0dcd3 1px, transparent 0);
            background-size: 20px 20px;
        }

        .cert-header {
            font-family: "Times New Roman", serif;
            font-size: 2.5rem;
            color: var(--primary);
            margin-bottom: 1rem;
            text-transform: uppercase;
            letter-spacing: 2px;
        }

        .cert-sub {
            font-size: 1.2rem;
            color: var(--secondary);
            margin-bottom: 2rem;
        }

        .cert-name {
            font-size: 2rem;
            font-family: "Cursive", serif; /* Fallback */
            border-bottom: 2px solid var(--secondary);
            display: inline-block;
            min-width: 300px;
            padding: 0 1rem;
            margin: 1rem 0;
            color: var(--accent);
        }

        .cert-stats {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 1rem;
            max-width: 600px;
            margin: 2rem auto;
            background: white;
            padding: 1.5rem;
            border: 1px solid #ddd;
            box-shadow: 5px 5px 0px rgba(0,0,0,0.1);
        }

        .cert-stat-item {
            text-align: left;
            border-bottom: 1px solid #eee;
            padding: 0.5rem 0;
        }
        
        .cert-final {
            grid-column: 1 / -1;
            text-align: center;
            font-size: 1.5rem;
            font-weight: bold;
            margin-top: 1rem;
            padding-top: 1rem;
            border-top: 2px dashed var(--accent);
            color: var(--primary);
        }

        .cert-footer {
            margin-top: 2rem;
            font-size: 0.9rem;
            color: #666;
        }

        .input-name {
            padding: 1rem;
            font-size: 1.2rem;
            width: 100%;
            max-width: 400px;
            margin-bottom: 1rem;
            border: 2px solid var(--secondary);
            border-radius: 4px;
        }

        /* Responsive */
        @media (max-width: 600px) {
            .nav-container {
                flex-direction: column;
            }
            .nav-btn {
                width: 100%;
                padding: 0.8rem;
            }
            .cert-stats {
                grid-template-columns: 1fr;
            }
        }
    </style>
</head>
<body>

    <header>
        <h1>Guia de Estudo: União Ibérica</h1>
        <p>História de Portugal (1580–1640)</p>
    </header>

    <nav>
        <div class="nav-container">
            <button class="nav-btn active" onclick="showSection('guia')">Guia de Estudo</button>
            <button class="nav-btn" onclick="showSection('quiz')">Questionário</button>
            <button class="nav-btn" onclick="showSection('glossario')">Glossário & Exercícios</button>
            <!-- Botão Certificado só aparece se desbloqueado -->
            <button id="btn-certificado" class="nav-btn" onclick="showSection('certificado')">★ Obter Certificado ★</button>
        </div>
    </nav>

    <main>
        <!-- SECÇÃO 1: GUIA DE ESTUDO -->
        <section id="guia" class="section-content active">
            <!-- Conteúdo do Guia mantido -->
            <h2>1. Origens da Crise Sucessória e o Início da União (1578–1581)</h2>
            <ul>
                <li><strong>A Tragédia Inicial:</strong> A crise começou em <strong>1578</strong> com a derrota na <strong>Batalha de Alcácer Quibir</strong>, onde desapareceu o jovem rei <strong>D. Sebastião</strong>.</li>
                <li><strong>Candidatos ao Trono:</strong> Após a morte do Cardeal D. Henrique (1580), os principais candidatos eram <strong>D. Catarina de Bragança</strong>, <strong>Filipe II de Espanha</strong> e <strong>D. António, Prior do Crato</strong>.</li>
                <li><strong>Apoio a Filipe II:</strong> Foi apoiado pela <strong>Nobreza, Alto Clero e Burguesia</strong>. Estes grupos esperavam estabilidade, novos negócios e acesso à prata/ouro da América espanhola.</li>
                <li><strong>Novo Rei:</strong> Filipe II de Espanha foi aclamado como <strong>Filipe I de Portugal</strong>.</li>
            </ul>

            <h2>2. A Fundação da União (Cortes de Tomar, 1581)</h2>
            <p>Nas Cortes de Tomar, Filipe I fez promessas fundamentais para garantir a aceitação dos portugueses, estabelecendo uma união de duas coroas independentes:</p>
            <ul>
                <li>A língua portuguesa continuaria a ser a oficial.</li>
                <li>A moeda portuguesa permaneceria a mesma.</li>
                <li>Os cargos administrativos seriam ocupados <strong>apenas por portugueses</strong>.</li>
                <li>Os territórios do Império Português continuariam sob governação portuguesa.</li>
            </ul>

            <h2>3. Causas da Destruição e Colapso Interno</h2>
            <ul>
                <li><strong>Violação das Promessas:</strong> O descontentamento cresceu porque os sucessores de Filipe I (Filipe III e IV de Espanha) começaram a desrespeitar o juramento de Tomar.</li>
                <li><strong>Crise Económica:</strong> Com a diminuição da prata da América, Espanha aumentou os <strong>impostos</strong> sobre Portugal e começou a nomear espanhóis para cargos portugueses.</li>
                <li><strong>Revolta Popular:</strong> O descontentamento alastrou da elite para o povo. Exemplo: <strong>Revolta do Manuelinho</strong> em Évora (1637), contra o aumento de impostos.</li>
            </ul>

            <h2>4. Fatores de Colapso Externo (Guerra Económica)</h2>
            <ul>
                <li><strong>Novos Inimigos:</strong> Ao unir-se a Espanha, Portugal herdou os inimigos desta: <strong>Holanda, Inglaterra e França</strong>.</li>
                <li><strong>O Alvo:</strong> As colónias e rotas comerciais portuguesas (Brasil, África, Oriente) tornaram-se alvos legítimos de ataque.</li>
                <li><strong>Arma Secreta:</strong> Holandeses e Ingleses usavam <strong>Companhias de Comércio</strong> (empresas privadas com acionistas), que eram mais ágeis que o monopólio estatal ibérico.</li>
                <li><strong>Desafio Ideológico:</strong> O jurista <strong>Hugo Grótios</strong> defendeu o <em>Mare Liberum</em> (Mar Livre), atacando a exclusividade do Tratado de Tordesilhas (<em>Mare Clausum</em>).</li>
            </ul>

            <div class="analogy-box">
                <h3>Analogia: O Choque de Modelos Económicos</h3>
                <p>O <strong>Modelo Ibérico</strong> era como um "navio-mãe" gigante e lento: estatal, focado apenas em ouro/prata e difícil de manobrar. Se o Estado falhava, tudo parava.</p>
                <p>O <strong>Modelo do Norte (Holandês/Inglês)</strong> era como um enxame de "lanchas rápidas": companhias privadas ágeis, financiadas por muitos investidores. Se uma falhasse, as outras continuavam a atacar e a lucrar.</p>
            </div>

            <h2>5. A Restauração de 1640</h2>
            <ul>
                <li><strong>A Faísca Final:</strong> A tentativa do <strong>Conde Duque de Olivares</strong> de recrutar nobres portugueses para combater na revolta da Catalunha.</li>
                <li><strong>O Golpe:</strong> A <strong>1 de dezembro de 1640</strong>, os "40 Conjurados" atacaram o Paço Real em Lisboa.</li>
                <li><strong>O Rei Restaurado:</strong> O Duque de Bragança foi aclamado como <strong>D. João IV</strong>.</li>
                <li><strong>A Guerra:</strong> Seguiu-se a Guerra da Restauração, que durou 28 anos, até ao reconhecimento oficial por Espanha em <strong>1668</strong>.</li>
            </ul>
        </section>

        <!-- SECÇÃO 2: QUESTIONÁRIO -->
        <section id="quiz" class="section-content">
            <h2>Questionário de Avaliação</h2>
            <p style="margin-bottom: 2rem;">Responda às 15 questões para testar o seu conhecimento. (Valerá para o certificado final)</p>

            <form id="quiz-form" onsubmit="return false;">
                
                <!-- A. Escolha Múltipla Única -->
                <h3>A. Escolha Múltipla</h3>
                
                <div class="question-block" id="q1">
                    <p class="question-text">1. Qual evento, em 1578, desencadeou diretamente a crise sucessória?</p>
                    <div class="options-container">
                        <label><input type="radio" name="q1" value="a"> Morte do Cardeal D. Henrique</label>
                        <label><input type="radio" name="q1" value="b"> Batalha de Alcácer Quibir</label>
                        <label><input type="radio" name="q1" value="c"> Cortes de Tomar</label>
                    </div>
                    <div class="feedback" id="fb-q1"></div>
                </div>

                <div class="question-block" id="q2">
                    <p class="question-text">2. Qual era o principal objetivo de Hugo Grótios com o "Mare Liberum"?</p>
                    <div class="options-container">
                        <label><input type="radio" name="q2" value="a"> Defender o Tratado de Tordesilhas</label>
                        <label><input type="radio" name="q2" value="b"> Apoiar o monopólio espanhol</label>
                        <label><input type="radio" name="q2" value="c"> Defender a liberdade de navegação e comércio para todos</label>
                    </div>
                    <div class="feedback" id="fb-q2"></div>
                </div>

                <div class="question-block" id="q3">
                    <p class="question-text">3. Qual foi uma promessa central das Cortes de Tomar violada por Madrid?</p>
                    <div class="options-container">
                        <label><input type="radio" name="q3" value="a"> Cargos administrativos apenas para portugueses</label>
                        <label><input type="radio" name="q3" value="b"> União total dos exércitos</label>
                        <label><input type="radio" name="q3" value="c"> Adoção do castelhano como língua oficial</label>
                    </div>
                    <div class="feedback" id="fb-q3"></div>
                </div>

                <div class="question-block" id="q4">
                    <p class="question-text">4. Qual o nome da revolta popular em Évora (1637)?</p>
                    <div class="options-container">
                        <label><input type="radio" name="q4" value="a"> Revolta das Sisas</label>
                        <label><input type="radio" name="q4" value="b"> Revolta do Manuelinho</label>
                        <label><input type="radio" name="q4" value="c"> Revolta da Catalunha</label>
                    </div>
                    <div class="feedback" id="fb-q4"></div>
                </div>

                <div class="question-block" id="q5">
                    <p class="question-text">5. Em que ano exato ocorreu a Restauração da Independência?</p>
                    <div class="options-container">
                        <label><input type="radio" name="q5" value="a"> 1580</label>
                        <label><input type="radio" name="q5" value="b"> 1640</label>
                        <label><input type="radio" name="q5" value="c"> 1668</label>
                    </div>
                    <div class="feedback" id="fb-q5"></div>
                </div>

                <!-- B. Escolha Múltipla (Várias Opções) -->
                <h3>B. Seleção Múltipla (Selecione todas as corretas)</h3>

                <div class="question-block" id="q6">
                    <p class="question-text">6. Quem apoiou Filipe II na sua subida ao trono?</p>
                    <div class="options-container">
                        <label><input type="checkbox" name="q6" value="a"> Alto Clero e Nobreza</label>
                        <label><input type="checkbox" name="q6" value="b"> O Povo (apoiantes de D. António)</label>
                        <label><input type="checkbox" name="q6" value="c"> Burguesia (interessada em negócios)</label>
                    </div>
                    <div class="feedback" id="fb-q6"></div>
                </div>

                <div class="question-block" id="q7">
                    <p class="question-text">7. Características do modelo económico do Norte da Europa:</p>
                    <div class="options-container">
                        <label><input type="checkbox" name="q7" value="a"> Uso de Companhias de Comércio privadas</label>
                        <label><input type="checkbox" name="q7" value="b"> Controlo estatal rígido e pesado</label>
                        <label><input type="checkbox" name="q7" value="c"> Focado em transporte, finanças e dinamismo</label>
                    </div>
                    <div class="feedback" id="fb-q7"></div>
                </div>

                <div class="question-block" id="q8">
                    <p class="question-text">8. Ações que violaram as Cortes de Tomar:</p>
                    <div class="options-container">
                        <label><input type="checkbox" name="q8" value="a"> Lançamento de impostos pesados para guerras espanholas</label>
                        <label><input type="checkbox" name="q8" value="b"> Nomeação de espanhóis para cargos portugueses</label>
                        <label><input type="checkbox" name="q8" value="c"> Manutenção da língua portuguesa</label>
                    </div>
                    <div class="feedback" id="fb-q8"></div>
                </div>

                <!-- C. Verdadeiro ou Falso -->
                <h3>C. Verdadeiro ou Falso</h3>

                <div class="question-block" id="q9">
                    <p class="question-text">9. A União Ibérica foi vista inicialmente como uma união de reinos iguais (monarquia dual), e não como uma conquista.</p>
                    <div class="options-container">
                        <label><input type="radio" name="q9" value="true"> Verdadeiro</label>
                        <label><input type="radio" name="q9" value="false"> Falso</label>
                    </div>
                    <div class="feedback" id="fb-q9"></div>
                </div>

                <div class="question-block" id="q10">
                    <p class="question-text">10. A nomeação de portugueses para cargos públicos foi estritamente cumprida por Madrid até 1640.</p>
                    <div class="options-container">
                        <label><input type="radio" name="q10" value="true"> Verdadeiro</label>
                        <label><input type="radio" name="q10" value="false"> Falso</label>
                    </div>
                    <div class="feedback" id="fb-q10"></div>
                </div>

                <div class="question-block" id="q11">
                    <p class="question-text">11. A guerra de restauração durou menos de 10 anos.</p>
                    <div class="options-container">
                        <label><input type="radio" name="q11" value="true"> Verdadeiro</label>
                        <label><input type="radio" name="q11" value="false"> Falso</label>
                    </div>
                    <div class="feedback" id="fb-q11"></div>
                </div>

                <!-- D. Drag & Drop (Correspondência) -->
                <h3>D. Associação de Termos</h3>
                <p>Selecione um termo na coluna da esquerda e depois clique na descrição correspondente na direita.</p>

                <div class="question-block" id="q12">
                    <div class="drag-container">
                        <div class="drag-column" id="col-terms-12"></div>
                        <div class="drag-column" id="col-desc-12"></div>
                    </div>
                    <div class="feedback" id="fb-q12"></div>
                </div>

                <div class="question-block" id="q13">
                    <p class="question-text">Associação Grupo 2:</p>
                    <div class="drag-container">
                        <div class="drag-column" id="col-terms-13"></div>
                        <div class="drag-column" id="col-desc-13"></div>
                    </div>
                    <div class="feedback" id="fb-q13"></div>
                </div>

                <!-- E. Ordenação Cronológica -->
                <h3>E. Ordenação Cronológica</h3>
                <p>Use as setas para colocar os eventos na ordem correta (do mais antigo para o mais recente).</p>

                <div class="question-block" id="q14">
                    <ul class="sortable-list" id="sort-q14"></ul>
                    <div class="feedback" id="fb-q14"></div>
                </div>

                <div class="question-block" id="q15">
                    <ul class="sortable-list" id="sort-q15"></ul>
                    <div class="feedback" id="fb-q15"></div>
                </div>

                <button class="btn-check" onclick="checkQuiz()">Submeter Questionário e Ver Pontuação</button>

                <div id="quiz-status-msg" style="display:none; margin-top: 1rem; text-align:center; font-weight:bold; color: var(--primary);">
                    Questionário Concluído! Pontuação salva. Complete agora o Glossário.
                </div>

            </form>
        </section>

        <!-- SECÇÃO 3: GLOSSÁRIO INTERATIVO E EXERCÍCIOS -->
        <section id="glossario" class="section-content">
            <h2>Glossário Interativo</h2>
            <p>Clique nos termos para expandir as definições.</p>
            <div class="glossary-grid" id="glossary-container"></div>

            <h2 style="margin-top: 4rem; color: var(--primary); border-bottom: 2px solid var(--accent);">5 Exercícios de Consolidação</h2>
            <p>Para obter o certificado final, complete os 5 exercícios abaixo.</p>

            <!-- Exercício 1 -->
            <div class="question-block" id="g1-block" style="margin-top: 2rem;">
                <h3>1. Conceitos Chave</h3>
                <p>Associe o conceito à sua definição:</p>
                <div class="drag-container">
                    <div class="drag-column" id="col-terms-g1"></div>
                    <div class="drag-column" id="col-desc-g1"></div>
                </div>
            </div>

            <!-- Exercício 2 -->
            <div class="question-block" id="g2-block">
                <h3>2. Personagens Históricas</h3>
                <p>Quem é quem na crise sucessória?</p>
                <div class="drag-container">
                    <div class="drag-column" id="col-terms-g2"></div>
                    <div class="drag-column" id="col-desc-g2"></div>
                </div>
            </div>

            <!-- Exercício 3 -->
            <div class="question-block" id="g3-block">
                <h3>3. Datas Importantes</h3>
                <p>Ligue o ano ao acontecimento:</p>
                <div class="drag-container">
                    <div class="drag-column" id="col-terms-g3"></div>
                    <div class="drag-column" id="col-desc-g3"></div>
                </div>
            </div>

             <!-- Exercício 4 -->
             <div class="question-block" id="g4-block">
                <h3>4. Economia e Política</h3>
                <p>Associe as causas e consequências:</p>
                <div class="drag-container">
                    <div class="drag-column" id="col-terms-g4"></div>
                    <div class="drag-column" id="col-desc-g4"></div>
                </div>
            </div>

            <!-- Exercício 5 -->
            <div class="question-block" id="g5-block">
                <h3>5. Geografia e Diplomacia</h3>
                <p>Ligue os locais/conceitos ao seu significado:</p>
                <div class="drag-container">
                    <div class="drag-column" id="col-terms-g5"></div>
                    <div class="drag-column" id="col-desc-g5"></div>
                </div>
            </div>

            <button class="btn-check" onclick="checkGlossary()">Submeter Exercícios do Glossário</button>
            <div id="glossary-feedback-final" class="feedback" style="text-align: center; margin-top:1rem;"></div>

        </section>

        <!-- SECÇÃO 4: CERTIFICADO (Inicialmente Vazio/Oculto) -->
        <section id="certificado" class="section-content">
            <h2>Certificado de Conclusão</h2>
            <p>Parabéns por concluir todas as atividades! Preencha o seu nome para gerar o certificado oficial.</p>
            
            <div style="text-align: center; margin: 2rem 0;">
                <input type="text" id="user-name" class="input-name" placeholder="Escreva o seu nome completo aqui...">
                <button class="btn-check" style="width: auto; background-color: var(--accent);" onclick="generateCertificate()">Gerar Documento</button>
            </div>

            <div id="certificate-display" style="display:none;">
                <div class="certificate-wrapper">
                    <div class="cert-header">Certificado de Aproveitamento</div>
                    <div class="cert-sub">Guia de Estudo da União Ibérica (1580–1640)</div>
                    
                    <p>Certifica-se que</p>
                    <div class="cert-name" id="cert-name-display">Nome do Aluno</div>
                    <p>concluiu com sucesso as atividades propostas.</p>

                    <div class="cert-stats">
                        <div class="cert-stat-item"><strong>Data:</strong> <span id="cert-date"></span></div>
                        <div class="cert-stat-item"><strong>Questionário:</strong> <span id="cert-score-quiz"></span></div>
                        <div class="cert-stat-item"><strong>Glossário (5 ex.):</strong> <span id="cert-score-gloss"></span></div>
                        <div class="cert-stat-item"><strong>Total Pontos:</strong> <span id="cert-score-total"></span></div>
                        
                        <div class="cert-final">
                            Classificação Final: <span id="cert-percent"></span><br>
                            <span id="cert-grade" style="font-size: 1.8rem; display:block; margin-top:0.5rem;"></span>
                        </div>
                    </div>

                    <div class="cert-footer">
                        <p>Este documento comprova a realização das tarefas de estudo autónomo.</p>
                        <button onclick="window.print()" style="margin-top:1rem; padding:0.5rem 1rem; cursor:pointer;">Imprimir Certificado</button>
                    </div>
                </div>
            </div>
        </section>

    </main>

    <script>
        // --- ESTADO GLOBAL DA APLICAÇÃO ---
        const appState = {
            quizCompleted: false,
            quizScore: 0,
            glossaryCompleted: false,
            glossaryScore: 0,
            totalPossibleQuiz: 15,
            totalPossibleGlossary: 20 // 5 exercícios x 4 pontos (simbólico, ou 4 itens cada)
        };

        // --- DADOS DO GLOSSÁRIO ---
        const glossaryData = [
            { term: "União Ibérica", def: "Período (1580-1640) em que Portugal e Espanha estiveram unidos sob a mesma coroa." },
            { term: "Império onde o sol nunca se punha", def: "Império Espanhol/Ibérico devido à sua vasta extensão global." },
            { term: "D. Sebastião", def: "Rei desaparecido em Alcácer Quibir (1578)." },
            { term: "Filipe I", def: "Rei que unificou a Península, prometendo autonomia em Tomar." },
            { term: "Hugo Grótios", def: "Jurista que defendeu o 'Mare Liberum'." },
            { term: "Conjurados", def: "Nobres que planearam o golpe de 1640." },
            { term: "Olivares", def: "Ministro espanhol que tentou centralizar o poder." },
            { term: "Restauração", def: "Fim do domínio espanhol em 1640." }
        ];

        // --- DADOS PARA EXERCÍCIOS DO GLOSSÁRIO (5 GRUPOS) ---
        const g1Data = [
            { term: "Mare Liberum", desc: "O mar é livre para todos navegarem." },
            { term: "Monarquia Dual", desc: "Dois reinos, um rei, leis separadas." },
            { term: "Mare Clausum", desc: "Exclusividade de navegação (Tordesilhas)." },
            { term: "Companhias", desc: "Empresas privadas com acionistas." }
        ];
        const g2Data = [
            { term: "D. Sebastião", desc: "O Desejado, desapareceu em África." },
            { term: "D. António", desc: "Prior do Crato, candidato popular." },
            { term: "Filipe II (Esp)", desc: "Tornou-se Filipe I de Portugal." },
            { term: "Duque de Bragança", desc: "Tornou-se D. João IV em 1640." }
        ];
        const g3Data = [
            { term: "1578", desc: "Batalha de Alcácer Quibir." },
            { term: "1580", desc: "Morte do Cardeal D. Henrique." },
            { term: "1637", desc: "Revolta do Manuelinho." },
            { term: "1640", desc: "Restauração da Independência." }
        ];
        const g4Data = [
            { term: "Modelo Ibérico", desc: "Estatal, lento, focado em metais." },
            { term: "Modelo Norte", desc: "Dinâmico, privado, focado em comércio." },
            { term: "Impostos", desc: "Aumentaram para pagar guerras espanholas." },
            { term: "Prata", desc: "Sua escassez causou crise em Espanha." }
        ];
        const g5Data = [
            { term: "Cortes de Tomar", desc: "Onde se selou o pacto da União." },
            { term: "Évora", desc: "Centro da Revolta do Manuelinho." },
            { term: "Holanda", desc: "Principal rival e atacante das colónias." },
            { term: "Brasil", desc: "Território atacado pelos holandeses." }
        ];


        // --- NAVEGAÇÃO E UI ---
        function showSection(id) {
            document.querySelectorAll('.section-content').forEach(el => el.classList.remove('active'));
            document.querySelectorAll('.nav-btn').forEach(el => el.classList.remove('active'));
            
            document.getElementById(id).classList.add('active');
            const buttons = document.querySelectorAll('.nav-btn');
            
            if(id === 'guia') buttons[0].classList.add('active');
            if(id === 'quiz') buttons[1].classList.add('active');
            if(id === 'glossario') buttons[2].classList.add('active');
            if(id === 'certificado') document.getElementById('btn-certificado').classList.add('active');
        }

        function checkUnlockCertificate() {
            if (appState.quizCompleted && appState.glossaryCompleted) {
                const btn = document.getElementById('btn-certificado');
                btn.classList.add('visible');
                // Opcional: alert("Parabéns! Desbloqueou o Certificado Final. Verifique o menu.");
            }
        }

        // --- INICIALIZAÇÃO ---
        window.onload = function() {
            // Render Glossário
            const glossaryContainer = document.getElementById('glossary-container');
            glossaryContainer.innerHTML = glossaryData.map(item => `
                <div class="glossary-item" onclick="toggleGlossary(this)">
                    <div class="glossary-header">
                        <span class="glossary-term">${item.term}</span>
                        <span class="glossary-toggle">+</span>
                    </div>
                    <div class="glossary-content"><p>${item.def}</p></div>
                </div>
            `).join('');

            // Inicializar Drag & Drop do Quiz
            const quizAssoc12 = [
                { term: "Cortes de Tomar", desc: "Local onde Filipe I fez promessas." },
                { term: "Companhias", desc: "Empresas privadas ágeis." }
            ];
            const quizAssoc13 = [
                { term: "Olivares", desc: "Provocou a revolta da Catalunha." },
                { term: "D. João IV", desc: "Rei aclamado em 1640." }
            ];
            renderAssociation('col-terms-12', 'col-desc-12', quizAssoc12, 'q12');
            renderAssociation('col-terms-13', 'col-desc-13', quizAssoc13, 'q13');

            // Inicializar Drag & Drop do Glossário (5 exercícios)
            renderAssociation('col-terms-g1', 'col-desc-g1', g1Data, 'g1');
            renderAssociation('col-terms-g2', 'col-desc-g2', g2Data, 'g2');
            renderAssociation('col-terms-g3', 'col-desc-g3', g3Data, 'g3');
            renderAssociation('col-terms-g4', 'col-desc-g4', g4Data, 'g4');
            renderAssociation('col-terms-g5', 'col-desc-g5', g5Data, 'g5');

            // Ordenação Quiz
            const orderData14 = [
                { id: "A", text: "Desaparecimento de D. Sebastião (1578)" },
                { id: "B", text: "Morte do Cardeal D. Henrique (1580)" },
                { id: "C", text: "Cortes de Tomar (1581)" }
            ];
            const orderData15 = [
                { id: "A", text: "Revolta do Manuelinho (1637)" },
                { id: "B", text: "Restauração (1640)" },
                { id: "C", text: "Paz com Espanha (1668)" }
            ];
            renderSortable('sort-q14', orderData14.sort(() => Math.random() - 0.5));
            renderSortable('sort-q15', orderData15.sort(() => Math.random() - 0.5));
        };

        // --- LÓGICA VISUAL ---
        function toggleGlossary(element) {
            element.classList.toggle('expanded');
            const toggleBtn = element.querySelector('.glossary-toggle');
            toggleBtn.textContent = element.classList.contains('expanded') ? '−' : '+';
        }

        let selectedTerm = null;

        function renderAssociation(termColId, descColId, data, qPrefix) {
            const termContainer = document.getElementById(termColId);
            const descContainer = document.getElementById(descColId);
            
            let terms = [...data].sort(() => Math.random() - 0.5);
            let descs = [...data].sort(() => Math.random() - 0.5);

            termContainer.innerHTML = terms.map(item => 
                `<div class="draggable-item term-item" data-term="${item.term}" onclick="selectTerm(this, '${qPrefix}')">${item.term}</div>`
            ).join('');

            descContainer.innerHTML = descs.map(item => 
                `<div class="draggable-item desc-item" data-correct="${item.term}" onclick="matchDesc(this, '${qPrefix}')">${item.desc}</div>`
            ).join('');
        }

        function selectTerm(el, prefix) {
            const containerId = el.parentElement.id;
            document.querySelectorAll(`#${containerId} .term-item`).forEach(t => {
                t.style.borderColor = '#e2e8f0';
                t.style.backgroundColor = 'white';
            });
            
            el.style.borderColor = '#D97706';
            el.style.backgroundColor = '#FEF3C7';
            selectedTerm = { el: el, term: el.dataset.term, prefix: prefix };
        }

        function matchDesc(el, prefix) {
            if (!selectedTerm || selectedTerm.prefix !== prefix) return;

            el.dataset.userGuess = selectedTerm.term;
            const containerId = el.parentElement.id;
            
            // Limpar anteriores
            document.querySelectorAll(`#${containerId} .desc-item`).forEach(d => {
                if(d.dataset.userGuess === selectedTerm.term && d !== el) delete d.dataset.userGuess; 
            });

            el.style.borderColor = '#D97706';
            el.innerHTML = `<strong>[${selectedTerm.term}]</strong> ${el.innerText.replace(/^\[.*?\] /, '')}`;
            
            selectedTerm.el.style.borderColor = '#10B981';
            selectedTerm.el.style.backgroundColor = '#ECFDF5';
            selectedTerm = null;
        }

        function renderSortable(containerId, data) {
            const container = document.getElementById(containerId);
            container.innerHTML = data.map(item => `
                <li class="sortable-item" data-id="${item.id}">
                    <div style="display:flex; flex-direction:column; margin-right:10px;">
                        <button type="button" onclick="moveUp(this)">&#9650;</button>
                        <button type="button" onclick="moveDown(this)">&#9660;</button>
                    </div>
                    ${item.text}
                </li>
            `).join('');
        }

        function moveUp(btn) {
            const li = btn.closest('li');
            if (li.previousElementSibling) li.parentNode.insertBefore(li, li.previousElementSibling);
        }
        function moveDown(btn) {
            const li = btn.closest('li');
            if (li.nextElementSibling) li.parentNode.insertBefore(li.nextElementSibling, li);
        }

        // --- VERIFICAÇÃO QUIZ ---
        function checkQuiz() {
            let score = 0;
            const feedback = (id, isCorrect, msg) => {
                const el = document.getElementById('fb-' + id);
                if(el) {
                    el.className = isCorrect ? 'feedback correct' : 'feedback incorrect';
                    el.style.display = 'block';
                    el.innerHTML = isCorrect ? `<strong>Correto!</strong>` : `<strong>Incorreto.</strong> ${msg}`;
                }
            };

            // Q1-Q5 (Radio)
            if (document.querySelector('input[name="q1"]:checked')?.value === 'b') score++; else feedback('q1', false, 'Alcácer Quibir.');
            if (document.querySelector('input[name="q2"]:checked')?.value === 'c') score++; else feedback('q2', false, 'Liberdade de navegação.');
            if (document.querySelector('input[name="q3"]:checked')?.value === 'a') score++; else feedback('q3', false, 'Cargos para portugueses.');
            if (document.querySelector('input[name="q4"]:checked')?.value === 'b') score++; else feedback('q4', false, 'Revolta do Manuelinho.');
            if (document.querySelector('input[name="q5"]:checked')?.value === 'b') score++; else feedback('q5', false, '1640.');

            // Q6-Q8 (Checkboxes - Simplified logic: needs all correct to get point)
            const q6 = Array.from(document.querySelectorAll('input[name="q6"]:checked')).map(e=>e.value);
            if (q6.includes('a') && q6.includes('c') && q6.length === 2) score++; else feedback('q6', false, 'Nobreza, Clero e Burguesia.');
            
            const q7 = Array.from(document.querySelectorAll('input[name="q7"]:checked')).map(e=>e.value);
            if (q7.includes('a') && q7.includes('c') && q7.length === 2) score++; else feedback('q7', false, 'Companhias privadas e dinamismo.');
            
            const q8 = Array.from(document.querySelectorAll('input[name="q8"]:checked')).map(e=>e.value);
            if (q8.includes('a') && q8.includes('b') && q8.length === 2) score++; else feedback('q8', false, 'Impostos e cargos.');

            // Q9-Q11 (V/F)
            if (document.querySelector('input[name="q9"]:checked')?.value === 'true') score++; else feedback('q9', false, 'Verdadeiro.');
            if (document.querySelector('input[name="q10"]:checked')?.value === 'false') score++; else feedback('q10', false, 'Falso.');
            if (document.querySelector('input[name="q11"]:checked')?.value === 'false') score++; else feedback('q11', false, 'Falso.');

            // Q12-Q13 (Assoc)
            let q12Ok = true;
            document.querySelectorAll('#col-desc-12 .desc-item').forEach(el => { if(el.dataset.userGuess !== el.dataset.correct) q12Ok = false; });
            if (document.querySelectorAll('#col-desc-12 .desc-item[data-user-guess]').length === 2 && q12Ok) score++; else feedback('q12', false, 'Reveja.');

            let q13Ok = true;
            document.querySelectorAll('#col-desc-13 .desc-item').forEach(el => { if(el.dataset.userGuess !== el.dataset.correct) q13Ok = false; });
            if (document.querySelectorAll('#col-desc-13 .desc-item[data-user-guess]').length === 2 && q13Ok) score++; else feedback('q13', false, 'Reveja.');

            // Q14-Q15 (Order)
            const q14 = Array.from(document.querySelectorAll('#sort-q14 li')).map(li => li.dataset.id).join('');
            if(q14 === 'ABC') score++; else feedback('q14', false, 'Ordem incorreta.');
            
            const q15 = Array.from(document.querySelectorAll('#sort-q15 li')).map(li => li.dataset.id).join('');
            if(q15 === 'ABC') score++; else feedback('q15', false, 'Ordem incorreta.');

            // SAVE STATE
            appState.quizScore = score;
            appState.quizCompleted = true;

            const msg = document.getElementById('quiz-status-msg');
            msg.style.display = 'block';
            msg.innerText = `Questionário submetido! Sua pontuação: ${score}/15. Continue para o Glossário.`;
            
            checkUnlockCertificate();
        }

        // --- VERIFICAÇÃO GLOSSÁRIO (5 Exercícios) ---
        function checkGlossary() {
            let score = 0;
            let allAttempted = true;
            const exercises = ['g1', 'g2', 'g3', 'g4', 'g5'];
            const maxPointsPerExercise = 4; // 1 point per correct pair within the exercise

            // Reset styles
            document.querySelectorAll('#glossario .desc-item').forEach(el => {
                el.style.border = '1px solid #e2e8f0';
            });

            exercises.forEach(exId => {
                const items = document.querySelectorAll(`#col-desc-${exId} .desc-item`);
                let correctCount = 0;
                let attemptedCount = 0;

                items.forEach(el => {
                    if (el.dataset.userGuess) {
                        attemptedCount++;
                        if (el.dataset.userGuess === el.dataset.correct) {
                            correctCount++;
                            el.style.border = '2px solid var(--success)'; // Visual feedback correct
                        } else {
                            el.style.border = '2px solid var(--error)'; // Visual feedback wrong
                        }
                    }
                });

                if (attemptedCount < items.length) allAttempted = false;
                score += correctCount; // Add correct pairs to total score
            });

            const fb = document.getElementById('glossary-feedback-final');
            fb.style.display = 'block';

            if (!allAttempted) {
                fb.className = 'feedback incorrect';
                fb.innerText = "Atenção: Ainda não associou todos os termos em todos os 5 exercícios.";
                return;
            }

            appState.glossaryScore = score;
            appState.glossaryCompleted = true;
            
            fb.className = 'feedback correct';
            fb.innerHTML = `<strong>Exercícios Concluídos!</strong> Pontuação obtida: ${score} / 20.<br>Se já fez o quiz, o certificado está agora disponível no topo da página.`;

            checkUnlockCertificate();
        }

        // --- GERAR CERTIFICADO ---
        function generateCertificate() {
            const name = document.getElementById('user-name').value;
            if (!name.trim()) {
                alert("Por favor, introduza o seu nome.");
                return;
            }

            // Calculate Totals
            const totalPoints = appState.quizScore + appState.glossaryScore;
            const maxPoints = appState.totalPossibleQuiz + appState.totalPossibleGlossary; // 15 + 20 = 35
            const percentage = Math.round((totalPoints / maxPoints) * 100);

            // Qualitative Scale
            let grade = "";
            if (percentage >= 100) grade = "Excelente";
            else if (percentage >= 90) grade = "Muito Bom";
            else if (percentage >= 70) grade = "Bom";
            else if (percentage >= 50) grade = "Satisfaz";
            else grade = "Não Satisfaz";

            // Render
            document.getElementById('cert-name-display').innerText = name;
            document.getElementById('cert-date').innerText = new Date().toLocaleDateString('pt-PT');
            document.getElementById('cert-score-quiz').innerText = `${appState.quizScore} / ${appState.totalPossibleQuiz}`;
            document.getElementById('cert-score-gloss').innerText = `${appState.glossaryScore} / ${appState.totalPossibleGlossary}`;
            document.getElementById('cert-score-total').innerText = totalPoints;
            document.getElementById('cert-percent').innerText = `${percentage}%`;
            
            const gradeEl = document.getElementById('cert-grade');
            gradeEl.innerText = grade;

            // Color coding grade
            if (percentage < 50) gradeEl.style.color = 'var(--error)';
            else if (percentage < 90) gradeEl.style.color = 'var(--accent)';
            else gradeEl.style.color = 'var(--success)';

            document.getElementById('certificate-display').style.display = 'block';
            document.getElementById('certificate-display').scrollIntoView({behavior: 'smooth'});
        }
    </script>
</body>
</html>